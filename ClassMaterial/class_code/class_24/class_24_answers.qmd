---
title: "Class 24 notes and code"
format: pdf
editor: source
editor_options: 
  chunk_output_type: console
---








# Part 1: Hypothesis test for multiple proportions using randomization methods


A Yale professor was interesting in examining whether Yale students were equally
likely to be born in each month. To test this he gathered data on the birth
months of 198 randomly selected Yale students. The data is loaded in the R chunk
below.

Please help him test whether the birth months are uniformly distributed across
the 12 months of the year using randomization methods to create the null 
distribution.



$\\$



Step 1: State the null and alternative hypotheses

$H_0: \pi_{Jan} = \pi_{Feb} = ... = \pi_{Dec} = 1/12$  
$H_A:$ At least one of the monthly proportions is different from 1/12  




```{r chi_squared_test_multiple_proportions}

library(SDS1000)

yale_births <- read.csv("yale_birth_data.csv")
birth_months <- yale_births$birth_month

# Observed counts
observed_counts <- table(birth_months)

# Expected counts (assuming uniform distribution)
n <- length(birth_months)
expected_counts <- rep(1/12, 12) * n

# Alternative way to get the expected counts
# expected_counts <- rep(sum(observed_counts) / length(observed_counts), length(observed_counts))  



# Step 2: Calculate the chi-squared test statistic

# Calculate the chi-squared test statistic
chi_squared_stat <- sum((observed_counts - expected_counts)^2 / expected_counts)
chi_squared_stat



# Step 3: Create a null distribution using randomization methods

null_dist <- do_it(10000) * {
  
  simulated_sample <- rmultinom(1, n, prob = rep(1/12, 12))
  simulated_chi_squared <- sum((simulated_sample - expected_counts)^2 / expected_counts)
  
}


# Visualize the null distribution
hist(null_dist, breaks = 30, 
     main = "Null distribution of chi-squared statistic",
     xlab = "Chi-squared value")

abline(v = chi_squared_stat, col = "red", lwd = 2)




# Step 4: Calculate the p-value
p_value <- pnull(chi_squared_stat, null_dist, lower.tail = FALSE)
p_value



```



Step 5: Make a decision


Since our p-value is very large, we do not reject the null hypothesis. We
conclude that there is not enough evidence to suggest that the birth months of
Yale students are not uniformly distributed across the 12 months of the year.



$\\$





# Part 2: Chi-squared test for comparing multiple proportions 

Let's rerun the hypothesis test from Part 3, but this time using a parametric
chi-squared test.

Our null and alternative hypotheses are the same as in Part 3. So is the observed
statistic we calculated earlier. So let's jump in at step 3 and start by 
visualizing the null distribution, and then go from there...



```{r chi_squared_test_multiple_proportions_parametric}


# reminder of our chi-squared statistic
chi_squared_stat
                       



# Step 3: Visualize the null distribution

# Degrees of freedom
df <- length(observed_counts) - 1

x_values_null <- seq(0, 30, length.out = 1000)
density_values_null <- dchisq(x_values_null, df)

plot(x_values_null, density_values_null, type = "l",
     main = "Null Distribution of Chi-squared statistic",
     xlab = "Chi-squared value",
     ylab = "Density",
     col = "blue")

abline(v = chi_squared_stat, col = "red", lwd = 2)



# Step 4: Calculate the p-value
p_value <- pchisq(chi_squared_stat, df, lower.tail = FALSE)
p_value

```



Step 5: Make a decision

Since our p-value is very large again, we still do not reject the null hypothesis. 
We conclude that there is not enough evidence to suggest that the birth months of
Yale students are not uniformly distributed across the 12 months of the year.




$\\$




# Part 3: Jury selection in Alameda county 

Section 197 of California's Code of Civil Procedure says: 

"All persons selected for jury service shall be selected at random, from a
source or sources inclusive of a representative cross section of the population
of the area served by the court."


In 2010, the American Civil Liberties Union (ACLU) of Northern California
presented a report that concluded that certain racial and ethnic groups are
underrepresented among jury panelists in Alameda County.

The table below summarizes the ACLU's findings, comparing the racial/ethnic
composition of the jury panelists to that of the eligible population from which
they were drawn, based on 1453 people who were on jury panels. 

| Group    | Asian | Black | Latino | White | Other |
|----------|:-----:|:-----:|:------:|:-----:|:-----:|
| Eligible | 0.15  | 0.18  | 0.12   | 0.54  | 0.01  |
| Panel    | 0.26  | 0.08  | 0.08   | 0.54  | 0.04  |


Using a chi-squared test, assess whether there is evidence that the
racial/ethnic composition of the jury panelists differs from that of the
eligible population.


```{r chi_squared_test_jury_selection}

# Given data
total_jury <- 1453
eligible_population <- c(.15, .08, .08, .54, .04) 
jury_panelists  <- c(.26, .18, .12, .54, .01) 


# Expected counts based on eligible population proportions
expected_counts <- eligible_population  * total_jury

# Observed counts
observed_counts <- jury_panelists * total_jury


# Step 2: Calculate the chi-squared test statistic
chi_squared_stat <- sum((observed_counts - expected_counts)^2 / expected_counts)
chi_squared_stat



# Step 3: Visualize the null distribution
df <- length(observed_counts) - 1

x_values_null <- seq(0, 50, length.out = 1000)
density_values_null <- dchisq(x_values_null, df)

plot(x_values_null, density_values_null, type = "l",
     main = "Null Distribution of Chi-squared statistic",
     xlab = "Chi-squared value",
     ylab = "Density",
     col = "blue")
abline(v = chi_squared_stat, col = "red", lwd = 2)



# Step 4: Calculate the p-value
p_value <- pchisq(chi_squared_stat, df, lower.tail = FALSE)
p_value


```



Step 5: Make a decision

Since our p-value is very small, we reject the null hypothesis. We conclude that
there is strong evidence to suggest that the racial/ethnic composition of the jury
panelists differs from that of the eligible population.
 
 
 
 
$\\$
 
 
 

 
 
# Part 4: One-way Analysis of Variance (ANOVA)


A group of Hope College students wanted to see if there was an association
between a studentâ€™s major and the time it takes to complete a small Sudoku-like
puzzle


They grouped majors into four categories

* Applied science (as)
* Natural science (ns)
* Social science  (ss)
* Arts/humanities  (ah)

Let's run an ANOVA hypothesis test to see if there is an association between a
student's major and the time it takes to complete the puzzle.



$\\$



Step 1: State the null and alternative hypotheses



Words:

* Null hypothesis: The mean time to complete the puzzle is the same for all four groups  

* Alternative hypothesis: The mean time to complete the puzzle is not the same 
for all four groups  


Symbols:  

* $H_0: \mu_{as} = \mu_{ns} = \mu_{ss} = \mu_{ah}$   
* $H_A$: At least one of the means is different  




$\\$




```{r sudoku_viz}

library(SDS1000)


# load the data
sudoku_data <- read.table("MajorPuzzle.txt", header = TRUE)

completion_times <- sudoku_data$time
majors <- sudoku_data$major




# Step 2: visualize the data and calculate the F-statistic

boxplot(completion_times ~ majors, 
        main = "Time to complete puzzle by major",
        ylab = "Time (seconds)",
        col = c("lightblue", "lightgreen", "lightpink", "lightyellow"))



# calculate the observed statistic

obs_stat <- get_F_stat(completion_times, majors)
obs_stat




# Step 3: Visualize the null distribution

df1 <- length(unique(majors)) - 1  # K - 1
df2 <- length(completion_times) - length(unique(majors))  # N - K


# plot the null distribution
x_vals <- seq(0, 5, length.out = 1000)
y_vals <- df(x_vals, 3, 36)

plot(x_vals, y_vals, type = 'l')


# add a red vertical line at the observed statistic
abline(v = obs_stat, col = "red")


# Step 4: Calculate the p-value


p_value <- pf(obs_stat, df1, df2, lower.tail = FALSE)
p_value

```




$\\$


Step 5: Make decision

Since the p-value is greater than the typical cutoff of 0.05, we fail to reject
the null hypothesis. Thus we can't conclude that the mean time to complete the
puzzle is different for the different majors.





$\\$



Exercise for home: Try rerunning the analysis using randomization methods to create
the null distribution instead of the parametric F-distribution (see class 14
code if you get stuck). Do you get the same conclusion?





