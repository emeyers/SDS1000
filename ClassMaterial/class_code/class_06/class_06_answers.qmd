---
title: "Class 6 notes and code"
format: pdf
editor: source
editor_options: 
  chunk_output_type: console
---






# Part 1: Scatter plots and correlation

Let's use the data collected by [Fraumeni (1968)](https://academic.oup.com/jnci/article/41/5/1205/903436) 
to examine the relationship between the number of cigarette's sold per capita
and the rates of different types of cancer. 

The data is loaded below into a data frame named `smoking`. Cancer rates are 
reported as the number of deaths per 100,000 citizens. 


```{r smoking_data}

load("states_smoking.rda")

```



$\\$




### 1.1 Scatter plots

Start by creating a scatter plot between the number of cigarette's sold per 
capita (`CIG`) and the number of lung cancer deaths (`LUNG`). 


```{r smoking_scatter_plot}

plot(smoking$CIG, smoking$LUNG,
     xlab = "Cigarettes sold per capita (1960)",
     ylab = "Lung cancer deaths per 100,000",
     main = "Scatter plot of cigarettes sold vs lung cancer deaths")


```


$\\$


### 1.2 Scatter plots

Now let's examine the correlation between the number of cigarette's sold per 
capita (`CIG`) and the number of lug cancer deaths (`LUNG`). 

```{r smoking_correlation}


cor(smoking$CIG, smoking$LUNG)

```


$\\$



### 1.3 Additional explorations

Do you think there is a correlation between the number of cigarette's sold per
capita (`CIG`) and the rate of bladder cancer (`BLAD`) and/or luekemia (`LEUK`)?

Try the following to explore these questions:

1. Create scatter plots of these relationships cigarette's sold per and these 
types of cancer. Based on the scatter plot guess what the correlation values are.

2. Calculate the correlation values between cigarette's sold per capita and these
types of cancer. Do the correlation values match your expectations based on the
scatter plots?

3. Based on these results, do you think there is a real relationship between the
number of cigarette's sold per capita and these types of cancer?



```{r smoking_additional_explorations}

# Scatter plot of CIG vs BLAD
plot(smoking$CIG, smoking$BLAD,
     xlab = "Cigarettes sold per capita (1960)",
     ylab = "Bladder cancer deaths per 100,000",
     main = "Scatter plot of cigarettes sold vs bladder cancer deaths")


# Scatter plot of CIG vs LEUK
plot(smoking$CIG, smoking$LEUK,
     xlab = "Cigarettes sold per capita (1960)",
     ylab = "Leukemia deaths per 100,000",
     main = "Scatter plot of cigarettes sold vs leukemia deaths")


# Correlation between CIG and BLAD
cor(smoking$CIG, smoking$BLAD)


# Correlation between CIG and LEUK
cor(smoking$CIG, smoking$LEUK)


```




$\\$



# Part 2: Linear regression


Let's continue to use the smoking data to explore linear regression.


$\\$


### Part 2.1: Fitting a linear model

To start, let's fit a linear model predicting lung cancer deaths from the number of
cigarettes sold per capita. We can then recreate our scatter plot and add the regression
line to the plot.


```{r linear_regression}

# Fit a linear model predicting lung cancer deaths from cigarettes sold
lung_model <- lm(smoking$LUNG ~ smoking$CIG)

# Plot the data and the regression line
plot(smoking$CIG, smoking$LUNG,
     xlab = "Cigarettes sold per capita (1960)",
     ylab = "Lung cancer deaths per 100,000",
     main = "Scatter plot of cigarettes sold vs lung cancer deaths")


abline(lung_model, col = "red")

```


$\\$




### Part 2.2: Interpreting the model output

We can use the `coef()` function to extract the coefficients from the model.

Please do the following:

1. Extract the coefficients from the model using the `coef()` function.

2. Write down the equation of the regression line 
for predicting lung cancer deaths from the number of cigarettes sold per capita. 

3. Then interpret the coefficients in the context of this problem.



```{r linear_regression_coefficients}

coef(lung_model)

```

**Answer:**

1. The coefficients from the model are approximately:
   - Intercept: 6.47
   - Slope: 0.0053

2. The equation of the regression line is: $\hat{y} =  0.0053x + 6.47$, where $\hat{y}$ is the predicted number of lung cancer deaths per 100,000 and $x$ is the number of cigarettes sold per capita.

3. The intercept (6.47) represents the estimated number of lung cancer deaths per 100,000 when no cigarettes are sold per capita. This value may not have a practical interpretation in this context, as it is unlikely that there would be zero cigarette sales. 

The slope (0.0053) indicates that for each additional cigarette sold per capita, the number of lung cancer deaths per 100,000 is expected to increase by 0.0053. This suggests a positive association between cigarette sales and lung cancer deaths.



$\\$




### Part 2.3: Making predictions

Next, let's use the regression model to make a prediction.

Please predict the number of lung cancer deaths per 100,000 when 2,000
cigarettes are sold per capita, we can substitute $x = 2000$ into the regression
equation and/or use R! 


```{r linear_regression_prediction}

the_coefs <- coef(lung_model)

the_coefs[1] + the_coefs[2] * 2000


```




**Answer**


$\hat{y} = 0.0053(2000) + 6.47 = 10 + 6.47 = 17.1$

So, the predicted number of lung cancer deaths per 100,000 when 2,000 cigarettes are sold per capita is approximately 16.47.



$\\$



### Part 2.4: Exploring the residuas

Finally, let's explore the residuals from the model by doing the following:

1. Let's calculate the residual for the first state (Alabama) in the data set.

2. Let's use the `residuals()` function to extract all the residuals from the model.

3. Let's caluculate the sum of the squared residuals. R selects the optimal 
intercept (`a`) and slope (`b`) to minimize this quantity. 

To explore finding the optimal `a` and `b` by hand, try the online app at: https://gallery.shinyapps.io/simple_regression/



```{r linear_regression_residuals}

# Calculate the residual for Alabama
AL_residual <- smoking$LUNG[1] - (the_coefs[1] + the_coefs[2] * smoking$CIG[1])

AL_residual


# Extract all residuals
all_residuals <- residuals(lung_model)

# Calculate the sum of squared residuals
sum(all_residuals^2)


```


     



